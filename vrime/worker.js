(function(){"use strict";function L(n,e){self.onmessage=async i=>{await e;const{name:r,args:a,transferableIndices:t}=i.data,o=[];let c;try{const s=n[r];if(typeof s!="function"){console.error(`${r} is not an exposed worker function`),self.close();return}const d=await s(...a);a.forEach((u,k)=>t.includes(k)&&o.push(u)),c={type:"success",result:d,transferables:o}}catch(s){const{message:d,name:u}=s;c={type:"error",error:{message:d,name:u}}}self.postMessage(c,o)}}function T(n){return(...e)=>{const i={type:"control",name:n,args:e};self.postMessage(i)}}function A(n,e){e=e||{};const{url:i,init:r}=e;return new Promise(a=>{self.Module={...e?.Module,async onRuntimeInitialized(){r&&await r(),a(null)},locateFile(t,o){return(i||o)+t}},importScripts((i||"")+n)})}function W(n,...e){const i=Module.FS[n](...e);if(n!=="mkdir")return i}const l=(n,e)=>e.some(i=>n instanceof i);let I,D;function z(){return I||(I=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function V(){return D||(D=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _=new WeakMap,f=new WeakMap,m=new WeakMap;function R(n){const e=new Promise((i,r)=>{const a=()=>{n.removeEventListener("success",t),n.removeEventListener("error",o)},t=()=>{i(b(n.result)),a()},o=()=>{r(n.error),a()};n.addEventListener("success",t),n.addEventListener("error",o)});return m.set(e,n),e}function N(n){if(_.has(n))return;const e=new Promise((i,r)=>{const a=()=>{n.removeEventListener("complete",t),n.removeEventListener("error",o),n.removeEventListener("abort",o)},t=()=>{i(),a()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),a()};n.addEventListener("complete",t),n.addEventListener("error",o),n.addEventListener("abort",o)});_.set(n,e)}let v={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return _.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return b(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function S(n){v=n(v)}function H(n){return V().includes(n)?function(...e){return n.apply(w(this),e),b(this.request)}:function(...e){return b(n.apply(w(this),e))}}function K(n){return typeof n=="function"?H(n):(n instanceof IDBTransaction&&N(n),l(n,z())?new Proxy(n,v):n)}function b(n){if(n instanceof IDBRequest)return R(n);if(f.has(n))return f.get(n);const e=K(n);return e!==n&&(f.set(n,e),m.set(e,n)),e}const w=n=>m.get(n);function U(n,e,{blocked:i,upgrade:r,blocking:a,terminated:t}={}){const o=indexedDB.open(n,e),c=b(o);return r&&o.addEventListener("upgradeneeded",s=>{r(b(o.result),s.oldVersion,s.newVersion,b(o.transaction),s)}),i&&o.addEventListener("blocked",s=>i(s.oldVersion,s.newVersion,s)),c.then(s=>{t&&s.addEventListener("close",()=>t()),a&&s.addEventListener("versionchange",d=>a(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const J=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],h=new Map;function B(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(h.get(e))return h.get(e);const i=e.replace(/FromIndex$/,""),r=e!==i,a=G.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(a||J.includes(i)))return;const t=async function(o,...c){const s=this.transaction(o,a?"readwrite":"readonly");let d=s.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[i](...c),a&&s.done]))[0]};return h.set(e,t),t}S(n=>({...n,get:(e,i,r)=>B(e,i)||n.get(e,i,r),has:(e,i)=>!!B(e,i)||n.has(e,i)}));const Q=["continue","continuePrimaryKey","advance"],q={},$=new WeakMap,P=new WeakMap,X={get(n,e){if(!Q.includes(e))return n[e];let i=q[e];return i||(i=q[e]=function(...r){$.set(this,P.get(this)[e](...r))}),i}};async function*Y(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const i=new Proxy(e,X);for(P.set(i,e),m.set(i,w(e));e;)yield i,e=await($.get(i)||e.continue()),$.delete(i)}function E(n,e){return e===Symbol.asyncIterator&&l(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&l(n,[IDBIndex,IDBObjectStore])}S(n=>({...n,get(e,i,r){return E(e,i)?Y:n.get(e,i,r)},has(e,i){return E(e,i)||n.has(e,i)}}));const p="hash",j="content";class Z{dbPromise;constructor(e){this.dbPromise=U(e,1,{upgrade(i){i.createObjectStore(p),i.createObjectStore(j)}})}async getDB(){return this.dbPromise.catch(()=>{})}async get(e,i,r){const a=await this.getDB();if(await a?.get(p,e)===i)return a.get(j,e);const o=await fetch(r);if(!o.ok)throw new Error(`Fail to download ${e}`);const c=await o.arrayBuffer();return await a?.put(j,c,e),await a?.put(p,i,e),c}async invalidate(){return(await this.getDB())?.clear(p)}}var nn="\u6719\u6708\u62FC\u97F3",en="\u6719\u6708\u62FC\u97F3\xB7\u8BED\u53E5\u6D41",an="\u81EA\u7136\u7801\u53CC\u62FC",rn="\u667A\u80FDABC\u53CC\u62FC",on="\u5C0F\u9E64\u53CC\u62FC",tn="\u5FAE\u8F6F\u53CC\u62FC",sn="\u62FC\u97F3\u52A0\u52A0\u53CC\u62FC",cn="86\u4E94\u7B14",dn="86\u4E94\u7B14\xB7\u62FC\u97F3",bn="86\u4E94\u7B14\xB7\u7E41\u4F53",un="\u8896\u73CD\u7B80\u62FC",mn="\u5730\u7403\u62FC\u97F3",pn="\u6CE8\u97F3",yn="\u6CE8\u97F3\xB7\u5FEB\u6253",ln="\u6CE8\u97F3\xB7\u81FA\u7063\u6B63\u9AD4",_n="\u4ED3\u9889\u4E94\u4EE3",fn="\u4ED3\u9889\u4E94\u4EE3\xB7\u5FEB\u6253",vn="\u4E94\u7B14\u753B",wn="\u884C\u521730",hn="\u5638\u8766\u7C73",$n="\u6253\u5B57\u901F\u8BB0\u6CD5",jn="\u5FEB\u901F\u4ED3\u9889",gn="\u901F\u6210",xn="\u8BED\u71D5\u4E5D\u952E",kn="\u5C0F\u767D\u4E5D\u952E",Mn={luna_pinyin:nn,luna_pinyin_fluency:en,double_pinyin:an,double_pinyin_abc:rn,double_pinyin_flypy:on,double_pinyin_mspy:tn,double_pinyin_pyjj:sn,wubi86:cn,wubi_pinyin:dn,wubi_trad:bn,pinyin_simp:un,terra_pinyin:mn,bopomofo:pn,bopomofo_express:yn,bopomofo_tw:ln,cangjie5:_n,cangjie5_express:fn,stroke:vn,array30:wn,liur:hn,stenotype:$n,scj6:jn,quick5:gn,yuyan_t9_pinyin:xn,xiaobai_simp:kn},In={},Dn={dict:"luna_pinyin"},Sn={dict:"luna_pinyin",prism:"luna_quanpin"},Bn={dict:"luna_pinyin",prism:"double_pinyin"},qn={dict:"luna_pinyin",prism:"double_pinyin_abc"},Pn={dict:"luna_pinyin",prism:"double_pinyin_flypy"},En={dict:"luna_pinyin",prism:"double_pinyin_mspy"},Cn={dict:"luna_pinyin",prism:"double_pinyin_pyjj"},Fn={},On={dict:"wubi86",prism:"wubi_pinyin"},Ln={dict:"wubi86",prism:"wubi_trad"},Tn={},An={},Wn={dict:"terra_pinyin",prism:"bopomofo"},zn={dict:"terra_pinyin",prism:"bopomofo_express"},Vn={dict:"terra_pinyin",prism:"bopomofo_tw"},Rn={},Nn={dict:"cangjie5",prism:"cangjie5_express"},Hn={},Kn={},Un={dict:"liur.extended"},Jn={dict:"luna_pinyin",prism:"stenotype"},Gn={},Qn={},Xn={dict:"luna_pinyin",prism:"yuyan_t9_pinyin"},Yn={dict:"xiaobai",prism:"xiaobai_simp"},Zn={luna_pinyin:In,luna_pinyin_fluency:Dn,luna_quanpin:Sn,double_pinyin:Bn,double_pinyin_abc:qn,double_pinyin_flypy:Pn,double_pinyin_mspy:En,double_pinyin_pyjj:Cn,wubi86:Fn,wubi_pinyin:On,wubi_trad:Ln,pinyin_simp:Tn,terra_pinyin:An,bopomofo:Wn,bopomofo_express:zn,bopomofo_tw:Vn,cangjie5:Rn,cangjie5_express:Nn,stroke:Hn,array30:Kn,liur:Un,stenotype:Jn,scj6:Gn,quick5:Qn,yuyan_t9_pinyin:Xn,xiaobai_simp:Yn},ne="luna-pinyin",ee="luna-pinyin",ie="luna-pinyin",ae="double-pinyin",re="double-pinyin",oe="double-pinyin",te="double-pinyin",se="double-pinyin",ce="wubi",de="wubi",be="wubi",ue="pinyin-simp",me="terra-pinyin",pe="bopomofo",ye="bopomofo",le="bopomofo",_e="cangjie",fe="cangjie",ve="stroke",we="array",he="RobinChiu/rime-liur",$e="stenotype",je="scj",ge="quick",xe="zhou9110/rime-yuyan_t9_pinyin",ke="zhou9110/rime-xiaobai_simp",Me={luna_pinyin:ne,luna_pinyin_fluency:ee,luna_quanpin:ie,double_pinyin:ae,double_pinyin_abc:re,double_pinyin_flypy:oe,double_pinyin_mspy:te,double_pinyin_pyjj:se,wubi86:ce,wubi_pinyin:de,wubi_trad:be,pinyin_simp:ue,terra_pinyin:me,bopomofo:pe,bopomofo_express:ye,bopomofo_tw:le,cangjie5:_e,cangjie5_express:fe,stroke:ve,array30:we,liur:he,stenotype:$e,scj6:je,quick5:ge,yuyan_t9_pinyin:xe,xiaobai_simp:ke},Ie=["stroke"],De=["stroke"],Se=["luna_pinyin"],Be=["luna_pinyin"],qe=["luna_pinyin"],Pe=["luna_pinyin"],Ee=["luna_pinyin"],Ce=["pinyin_simp"],Fe=["pinyin_simp"],Oe=["pinyin_simp"],Le=["stroke"],Te=["stroke"],Ae=["terra_pinyin","stroke"],We=["terra_pinyin","stroke"],ze=["terra_pinyin","stroke"],Ve=["luna_quanpin"],Re=["luna_quanpin"],Ne=["luna_pinyin"],He=["luna_quanpin"],Ke=["luna_pinyin","terra_pinyin","bopomofo_tw"],Ue=["luna_pinyin"],Je=["luna_quanpin"],Ge=["luna_quanpin"],Qe=["luna_quanpin"],Xe=["luna_quanpin"],Ye={luna_pinyin:Ie,luna_pinyin_fluency:De,double_pinyin:Se,double_pinyin_abc:Be,double_pinyin_flypy:qe,double_pinyin_mspy:Pe,double_pinyin_pyjj:Ee,wubi86:Ce,wubi_pinyin:Fe,wubi_trad:Oe,pinyin_simp:Le,terra_pinyin:Te,bopomofo:Ae,bopomofo_express:We,bopomofo_tw:ze,cangjie5:Ve,cangjie5_express:Re,stroke:Ne,array30:He,liur:Ke,stenotype:Ue,scj6:Je,quick5:Ge,yuyan_t9_pinyin:Qe,xiaobai_simp:Xe},Ze=[{name:"wubi86.prism.bin",md5:"5342df80dbd13f9075ee5fb3d7e1864d"},{name:"wubi86.reverse.bin",md5:"fd84814998dbcc3feecc117ee8835ee3"},{name:"wubi86.schema.yaml",md5:"27665d14210c0d43abd62888684e3764"},{name:"wubi86.table.bin",md5:"5f9a629c8ed1b254ebe2897474e9d39b"},{name:"wubi_pinyin.prism.bin",md5:"d9357e99c526899d2a10d7a73c2d3a9a"},{name:"wubi_pinyin.schema.yaml",md5:"5c03a1ef1e24b2daa73bb1be3c692181"},{name:"wubi_trad.prism.bin",md5:"d6bf0d7efbb939e27da7394989a8fc4c"},{name:"wubi_trad.schema.yaml",md5:"c2477c2afe5f5845dafa49b3d14eeb10"}],ni=[{name:"bopomofo.prism.bin",md5:"20f4f5b4c1d5962592b79f5d03ca62be"},{name:"bopomofo.schema.yaml",md5:"518e4d14e2bb1fa5fb880e49bfca04e2"},{name:"bopomofo_express.prism.bin",md5:"c4739e7922241a5de99f8c10c00556d7"},{name:"bopomofo_express.schema.yaml",md5:"c1cda6a02b06f5c98ea44ab5dca7b5de"},{name:"bopomofo_tw.prism.bin",md5:"6c580fe09cc8dd21b4aa1db7caafe81b"},{name:"bopomofo_tw.schema.yaml",md5:"4b50fb3711fcd96935b5e38f34747293"}],ei=[{name:"cangjie5.prism.bin",md5:"2fd183a34ec7b60615cde2a374757068"},{name:"cangjie5.reverse.bin",md5:"9e7f3f857dbde199150ca2d384d261af"},{name:"cangjie5.schema.yaml",md5:"8bd6fc78f547d0520bab4296c89cbe1b"},{name:"cangjie5.table.bin",md5:"6f5beb82ee59fe9c5d58bb26b747e236"},{name:"cangjie5_express.prism.bin",md5:"9a21f30a2d455d0add5477ad37a38c56"},{name:"cangjie5_express.schema.yaml",md5:"85bf11d4830163bf07c03dc695233029"}],ii=[{name:"stroke.prism.bin",md5:"938b2ac58931574f43cd5f4372910f3d"},{name:"stroke.reverse.bin",md5:"ea86295f6242b933dd950e0097d633db"},{name:"stroke.schema.yaml",md5:"05a1e53ed66d7c2f70bbbf448b9a715b"},{name:"stroke.table.bin",md5:"0c9db75f0a3d29c99fda47217f200673"}],ai=[{name:"array30.prism.bin",md5:"cf688f01ffbe5ae924b57ab4472e7c12"},{name:"array30.reverse.bin",md5:"7f7d287012202461fc5ceb3f9eca2116"},{name:"array30.schema.yaml",md5:"b1810ce2e6da8d3e8fd0eebc6c647a89"},{name:"array30.table.bin",md5:"e6dde610a837ae475807936ae77270d0"}],ri=[{name:"stenotype.prism.bin",md5:"4bcd9c3421062988b413e56590737ed9"},{name:"stenotype.schema.yaml",md5:"9573616d7d7959583c0a7b00da760793"}],oi=[{name:"scj6.prism.bin",md5:"32691cfcc3d8d555ca0805254f0ea56b"},{name:"scj6.reverse.bin",md5:"9416475437a826df28a98fbd94304238"},{name:"scj6.schema.yaml",md5:"65e19d0a16c417f0e83b55cd9c1ae875"},{name:"scj6.table.bin",md5:"e2ba4165c93b07c8cb0cbd15056c1702"}],ti=[{name:"quick5.prism.bin",md5:"669c696dafa1a581385f1a2aecee9fa2"},{name:"quick5.reverse.bin",md5:"e18bfc0326cf5e6c38f69e7c12618beb"},{name:"quick5.schema.yaml",md5:"13426273fd9faa4e1a99acbf61a79f01"},{name:"quick5.table.bin",md5:"9ad21a1088e314df769664e3a2193329"}],si={"luna-pinyin":[{name:"luna_pinyin.prism.bin",md5:"7adb5fff55bfcc34e80435e5f210ce94"},{name:"luna_pinyin.reverse.bin",md5:"678415eba512b0a3a9dc5c04c0a30d4a"},{name:"luna_pinyin.schema.yaml",md5:"c80dd1f64b24e989a9ed2e350477ee72"},{name:"luna_pinyin.table.bin",md5:"abb85c5ced6d6f62e74bcf1103db4a29"},{name:"luna_pinyin_fluency.schema.yaml",md5:"46a551fd4b4d39979927924b6420a357"},{name:"luna_quanpin.prism.bin",md5:"8de235dc599aa52f6aa208061aef5081"},{name:"luna_quanpin.schema.yaml",md5:"9710cf104dd3fd696a193de7d0631eb4"}],"double-pinyin":[{name:"double_pinyin.prism.bin",md5:"3916578f37bba4f4cc785fd629afa6fb"},{name:"double_pinyin.schema.yaml",md5:"e46ac5659a0c8476156c1bc734935654"},{name:"double_pinyin_abc.prism.bin",md5:"bc241e6b4d56b12a99197c7ad18ecc6a"},{name:"double_pinyin_abc.schema.yaml",md5:"6455f079478da6abcd7c03c30b3a590b"},{name:"double_pinyin_flypy.prism.bin",md5:"016fe0f758bc1d23a9a1527846e4eee9"},{name:"double_pinyin_flypy.schema.yaml",md5:"f4ea4f1e2445a0e84f66d8344c7a9274"},{name:"double_pinyin_mspy.prism.bin",md5:"b08c9c69efc73172cedbc1d899a37e9c"},{name:"double_pinyin_mspy.schema.yaml",md5:"53832b7718101e9f29b8b32a8c504109"},{name:"double_pinyin_pyjj.prism.bin",md5:"29aa52b473206d46651d636000e6798a"},{name:"double_pinyin_pyjj.schema.yaml",md5:"955cce09b08451df7bb0c9faf3f3bba7"}],wubi:Ze,"pinyin-simp":[{name:"pinyin_simp.prism.bin",md5:"55ed9e70b8b40c996e2610ba413ddea7"},{name:"pinyin_simp.reverse.bin",md5:"0a6da52bdc7437661d449d59abdf8094"},{name:"pinyin_simp.schema.yaml",md5:"7f1576f8a89cbb1f350e273827c4271c"},{name:"pinyin_simp.table.bin",md5:"5a9c1633422d813e39f324461b9319c6"}],"terra-pinyin":[{name:"terra_pinyin.prism.bin",md5:"afe79bcb48e9d45c1b8d19abc3fa461b"},{name:"terra_pinyin.reverse.bin",md5:"3141ed6e017a820e45b3e11ed3312b4f"},{name:"terra_pinyin.schema.yaml",md5:"aaf95fc7c20eac05a00a9561adfc4d7e"},{name:"terra_pinyin.table.bin",md5:"9bb8ddce56f7bb2d21f8749485cc37da"}],bopomofo:ni,cangjie:ei,stroke:ii,array:ai,"RobinChiu/rime-liur":[{name:"liur.extended.prism.bin",md5:"bd32db02b5009c6c0b827c7e02b29a49"},{name:"liur.extended.reverse.bin",md5:"1bde999fb589c74299f857f3ee1fe96e"},{name:"liur.extended.table.bin",md5:"c81d5384ca1dbb8262262abf6f62cc7d"},{name:"liur.schema.yaml",md5:"690e609006fd4f726d2045a2549ae404"}],stenotype:ri,scj:oi,quick:ti,"zhou9110/rime-yuyan_t9_pinyin":[{name:"yuyan_t9_pinyin.prism.bin",md5:"7acfe18cb1317ad644054d2bf70b8b84"},{name:"yuyan_t9_pinyin.schema.yaml",md5:"2717eb5d236373a8d4f042518851cbb2"}],"zhou9110/rime-xiaobai_simp":[{name:"xiaobai.reverse.bin",md5:"bc0519b8692ba7edbcf044c4f19ee37a"},{name:"xiaobai.table.bin",md5:"ec5e9ce0f7b48c1be4ba34d7552ca31a"},{name:"xiaobai_simp.prism.bin",md5:"de4200b0261d09d7ec5ae48f54a1010e"},{name:"xiaobai_simp.schema.yaml",md5:"4f0bd61653fb1bf97c0986acc99ab151"}]};const g="/rime",ci="/usr/share/rime-data";function di(n,e){return`ime/${n}/${e}`}const bi=new Z("ime");async function ui(n){const e=[];function i(a){if(e.includes(a))return[];e.push(a);const t=[];for(const M of Ye[a]||[])t.push(...i(M));const{dict:o,prism:c}=Zn[a],s=o||a,d=`${s}.table.bin`,u=`${s}.reverse.bin`,k=`${c||s}.prism.bin`,_i=`${a}.schema.yaml`,F=Me[a];for(const M of[d,u,k,_i])for(const{name:O,md5:fi}of si[F])if(M===O){t.push({name:O,md5:fi,target:F});break}return t}const r=i(n);await Promise.all(r.map(async({name:a,target:t,md5:o})=>{const c=`${ci}/build/${a}`;try{Module.FS.lookupPath(c)}catch{const s=await bi.get(a,o,di(t,a));Module.FS.writeFile(c,new Uint8Array(s))}}))}async function mi(n){return x||await ui(n),Module.ccall("set_ime","null",["string"],[n]),y("write")}function y(n){let e,i;const r=new Promise((a,t)=>{e=a,i=t});return Module.FS.syncfs(n==="read",a=>{a&&i(a),e(null)}),r}const pi=A("rime.js",{url:"",async init(){Module.FS.mkdir(g),Module.FS.mount(IDBFS,{},g),await y("read"),Module.ccall("init","null",[],[]);for(const[n,e]of Object.entries(Mn))Module.ccall("set_schema_name","null",["string","string"],[n,e])},Module:{printErr(n){const e=n.match(/[EWID]\S+ \S+ \S+ (.*)/);e?{E:console.error,W:console.warn,I:console.info,D:console.debug}[n[0]](e[1]):console.error(n)}}});let x=!1;const yi=T("deployStatus");globalThis._deployStatus=(n,e)=>{n==="success"&&(x=!0),yi(n,e)};function C(n){for(const e of Module.FS.readdir(n)){if(e==="."||e==="..")continue;const i=`${n}/${e}`,{mode:r}=Module.FS.lstat(i);Module.FS.isDir(r)?(C(i),Module.FS.rmdir(i)):Module.FS.unlink(i)}}async function li(){C(g),await y("write"),x=!1,Module.ccall("reset","null",[],[])}L({fsOperate:W,resetUserDirectory:li,setIME:mi,setOption(n,e){return Module.ccall("set_option","null",["string","number"],[n,e])},setPageSize(n){return Module.ccall("set_page_size","null",["number"],[n])},deploy(){return Module.ccall("deploy","null",[],[])},async process(n){const e=JSON.parse(Module.ccall("process","string",["string"],[n]));return"committed"in e&&await y("write"),e},selectCandidateOnCurrentPage(n){return Module.ccall("select_candidate_on_current_page","string",["number"],[n])},changePage(n){return Module.ccall("change_page","string",["boolean"],[n])}},pi)})();
